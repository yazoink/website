[
  {
    "title": "Tunneling My Homelab",
    "entry": 2,
    "subheading": "Hosting public services without port forwarding",
    "date": "23 September 2024",
    "categories": ["Technology", "Self-hosting", "Networking", "NixOS"],
    "content": [
      "<p>Tunneling my homelab to a VPS was really a lot easier than I expected. For a good while I was reluctant to buy a VPS since I didn't know if I was actually going to get it to work, but after seeing <a href='https://blog.ahwx.org/frp' target='_blank'>this article about frp</a> I decided to give it a go.</p>",
      "<br />",
      "<p>The VPS I've gone with is a 2 GB Linode running Alpine Linux and my home servers are running NixOS.</p>",
      "<p>To enable frp on my home server, I've added a module like this:</p>",
      "<br />",
      "<div class='code-block'>",
      "<code>",
      "<p>{</p>",
      "<p>&emsp;services.frp = {</p>",
      "<p>&emsp;&emsp;enable = true;</p>",
      "<p>&emsp;&emsp;role = \"client\";</p>",
      "<p>&emsp;&emsp;settings = {</p>",
      "<p>&emsp;&emsp;&emsp;serverAddr = \"vps.public.ip.address\";</p>",
      "<p>&emsp;&emsp;&emsp;serverPort = 7000;</p>",
      "<p>&emsp;&emsp;&emsp;auth.method = \"token\";</p>",
      "<p>&emsp;&emsp;&emsp;auth.token = \"my token\";</p>",
      "<p>&emsp;&emsp;&emsp;transport.protocol = \"tcp\";</p>",
      "<p>&emsp;&emsp;&emsp;proxies = [</p>",
      "<p>&emsp;&emsp;&emsp;&emsp;{</p>",
      "<p>&emsp;&emsp;&emsp;&emsp;&emsp;name = \"my service\";</p>",
      "<p>&emsp;&emsp;&emsp;&emsp;&emsp;type = \"tcp\";</p>",
      "<p>&emsp;&emsp;&emsp;&emsp;&emsp;localIP = \"service.local.ip\";</p>",
      "<p>&emsp;&emsp;&emsp;&emsp;&emsp;localPort = service port number;</p>",
      "<p>&emsp;&emsp;&emsp;&emsp;&emsp;remotePort = service port number;</p>",
      "<p>&emsp;&emsp;&emsp;&emsp;}</p>",
      "<p>&emsp;&emsp;&emsp;];</p>",
      "<p>&emsp;&emsp;};</p>",
      "<p>&emsp;};</p>",
      "<p>}</p>",
      "</code>",
      "</div>",
      "<br />",
      "<p>To enable it on the VPS I installed frp with <code>doas apk add frp</code> and wrote the following to <code>/etc/frp/frps.toml:</code></p>",
      "<br />",
      "<div class='code-block'>",
      "<code>",
      "<p>bindPort = 7000</p>",
      "<p>auth.method = \"token\"</p>",
      "<p>auth.token = \"my token\"</p>",
      "</code>",
      "</div>",
      "<br />",
      "<p>And that's all there is to it! You can now access all the forwarded services from the address of your VPS.</p>",
      "<br />",
      "<p>I also use Caddy as a reverse proxy to enable HTTPS and map the all of the services to subdomains. To do this all you need is to install Caddy and create a file under <code>/etc/caddy/Caddyfile</code> that looks something like this:</p>",
      "<br />",
      "<div class='code-block'>",
      "<code>",
      "<p>\"myservice.domain.tld\" {</p>",
      "<p>&emsp;reverse_proxy vps.public.ip:port</p>",
      "<p>}</p>",
      "</code>",
      "</div>",
      "<br />",
      "<p>So far it's been very fast and stable, I definitely reccommend trying this if you're looking for a way to host your homelab publically without port forwarding or revealing your IP.</p>"
    ]
  },
  {
    "title": "A Simple Blog",
    "entry": 1,
    "subheading": "An uninteresting post about how this thing works",
    "date": "22 September 2024",
    "categories": ["Technology", "PHP", "Self-hosting", "JSON", "Programming"],
    "content": [
      "<p>I gave up on trying to maintain a blog while still hosting this site on Neocities, since maintaining a blog in pure HTML/CSS is a massive pain in the ass. Now, since I'm hosting this on my personal server there are pretty much no limitations, so I've rewritten this site in PHP. My \"blogging engine\" solution is very rudimentary but it definitely gets the job done miles better than the old way.</p>",
      "<br />",
      "<p>I can't be fucked to set up a full content management system or a SQL database for this so I'm just putting all of my posts in a JSON file structured like this:</p>",
      "<br />",
      "<div class='code-block'>",
      "<code>",
      "<p>[</p>",
      "<p>&emsp;{</p>",
      "<p>&emsp;&emsp;\"title\": \"Example Blog Entry\",</p>",
      "<p>&emsp;&emsp;\"entry\": 1,</p>",
      "<p>&emsp;&emsp;\"subheading\": \"This is a blog post\",</p>",
      "<p>&emsp;&emsp;\"date\": \"22 September 2024\",</p>",
      "<p>&emsp;&emsp;\"categories\": [\"Personal\" \"Technology\"],</p>",
      "<p>&emsp;&emsp;\"content\": [</p>",
      "<p>&emsp;&emsp;&emsp;\"&lt;p&gt;This is a paragraph.&lt;/p&gt;\",</p>",
      "<p>&emsp;&emsp;&emsp;\"&lt;p&gt;This is another paragraph.&lt;/p&gt;\"</p>",
      "<p>&emsp;&emsp;]</p>",
      "<p>&emsp;}</p>",
      "<p>]</p>",
      "</code>",
      "</div>",
      "<br />",
      "<p>It's obviously not an optimal solution since I have to SSH into my server and edit a JSON file to make a blog post but it's more than doable. Maybe in the future I'll consider making some kind of UI for it but I'm fairly content with it as-is.</p>",
      "<br />",
      "<p>I've also written an RSS feed generator that looks like this:</p>",
      "<br />",
      "<div class='code-block'>",
      "<code>",
      "<p>&lt;?php</p>",
      "<p>require 'dynamic/variables.php';</p>",
      "<br />",
      "<p>$jsonStr = file_get_contents('json/blog.json');</p>",
      "<p>$json = json_decode($jsonStr, true);</p>",
      "<br />",
      "<p>header(\"Content-Type: application/rss+xml; charset=UTF-8\");</p>",
      "<p>echo \"&lt;?xml version='1.0' encoding='UTF-8'?&gt;\";</p>",
      "<p>echo \"&lt;rss version='2.0'&gt;\";</p>",
      "<p>echo \"&lt;channel&gt;\";</p>",
      "<p>echo \"&lt;title>yazoink&lt;/title&gt;\";</p>",
      "<p>echo \"&lt;link&gt;https://$domain&lt;/link&gt;\";</p>",
      "<p>echo \"&lt;description>yazoink's blog&lt;/description&gt;\";</p>",
      "<p>foreach ($json as $blogEntry) {</p>",
      "<p>&emsp;echo \"&lt;item&gt;\";</p>",
      "<p>&emsp;echo \"&lt;title&gt;\" . $blogEntry['title'] . \"&lt;/title&gt;\";</p>",
      "<p>&emsp;echo \"&lt;link&gt;https://$domain/index.php?nav=Blog&amp;entry=\" . $blogEntry['entry'] . \"&lt;/link&gt;\";</p>",
      "<p>&emsp;echo \"&lt;description&gt;\" . $blogEntry['subheading'] . \"&lt;/description&gt;\";</p>",
      "<p>&emsp;echo \"&lt;pubDate&gt;\" . date(DATE_RSS, strtotime($blogEntry['date'])) . \"&lt;/pubDate&gt;\";</p>",
      "<p>&emsp;echo \"&lt;/item&gt;\";</p>",
      "<p>}</p>",
      "<p>echo \"&lt;/channel&gt;\";</p>",
      "<p>echo \"&lt;/rss&gt;\";</p>",
      "<p>?&gt;</p>",
      "</code>",
      "</div>"
    ]
  }
]
